Add comprehensive tests for the current changes including:
- Unit tests
- Edge cases
- Error handling